{{range .Types}}
// Getter for additional properties for {{.TypeName}}. Returns the specified
// element and whether it was found
func (a {{.TypeName}}) Get(fieldName string) (value {{.Descriptor.AdditionalPropertiesType}}, found bool) {
    if a.additionalProperties != nil {
        value, found = a.additionalProperties[fieldName]
    }
    return
}

// Setter for additional properties for {{.TypeName}}
func (a *{{.TypeName}}) Set(fieldName string, value {{.Descriptor.AdditionalPropertiesType}}) {
    if a.additionalProperties == nil {
        a.additionalProperties = make(map[string]{{.Descriptor.AdditionalPropertiesType}})
    }
    a.additionalProperties[fieldName] = value
}

// Override default JSON handling for {{.TypeName}} to handle additionalProperties
func (a *{{.TypeName}}) UnmarshalJSON(b []byte) error {
    object := make(map[string]json.RawMessage)
	err := json.Unmarshal(b, &object)
	if err != nil {
		return err
	}
{{range .Descriptor.Fields}}
    if raw, found := object["{{.JsonName}}"]; found {
        err = json.Unmarshal(raw, &a.{{.GoName}})
        if err != nil {
            return errors.Wrap(err, "error reading '{{.JsonName}}'")
        }
        delete(object, "{{.JsonName}}")
    }
{{end}}
    a.additionalProperties = make(map[string]{{.Descriptor.AdditionalPropertiesType}})
    for fieldName, fieldBuf := range object {
        var fieldVal {{.Descriptor.AdditionalPropertiesType}}
        err := json.Unmarshal(fieldBuf, &fieldVal)
        if err != nil {
            return errors.Wrap(err, fmt.Sprintf("error unmarshaling field %s", fieldName))
        }
        a.additionalProperties[fieldName] = fieldVal
    }
	return nil
}

// Override default JSON handling for {{.TypeName}} to handle additionalProperties
func (a {{.TypeName}}) MarshalJSON() ([]byte, error) {
    var err error
    object := make(map[string]json.RawMessage)
{{range .Descriptor.Fields}}
{{if not .Required}}if a.{{.GoName}} != nil { {{end}}
    object["{{.JsonName}}"], err = json.Marshal(a.{{.GoName}})
    if err != nil {
        return nil, errors.Wrap(err, fmt.Sprintf("error marshaling '{{.JsonName}}'"))
    }
{{if not .Required}} }{{end}}
{{end}}
    for fieldName, field := range a.additionalProperties {
		object[fieldName], err = json.Marshal(field)
		if err != nil {
			return nil, errors.Wrap(err, fmt.Sprintf("error marshaling '%s'", fieldName))
		}
	}
	return json.Marshal(object)
}
{{end}}
